# Nest RS

Projeto NestJS com Prisma ORM e PostgreSQL desenvolvido durante o curso da Rocketseat.

## ğŸš€ Tecnologias

Este projeto foi desenvolvido com as seguintes tecnologias:

- [NestJS](https://nestjs.com/) - Framework Node.js progressivo
- [TypeScript](https://www.typescriptlang.org/) - JavaScript com tipagem estÃ¡tica
- [Prisma](https://www.prisma.io/) - ORM moderno para Node.js e TypeScript
- [PostgreSQL](https://www.postgresql.org/) - Banco de dados relacional
- [Docker](https://www.docker.com/) - ContainerizaÃ§Ã£o
- [Zod](https://zod.dev/) - ValidaÃ§Ã£o de schemas TypeScript-first
- [bcryptjs](https://github.com/dcodeIO/bcrypt.js) - Hash de senhas

## ğŸ“‹ PrÃ©-requisitos

- Node.js (versÃ£o 18 ou superior)
- Docker e Docker Compose
- npm ou yarn

## ğŸ”§ InstalaÃ§Ã£o

1. Clone o repositÃ³rio:
```bash
git clone <url-do-repositorio>
cd nest-rs
```

2. Instale as dependÃªncias:
```bash
npm install
```

3. Crie o arquivo `.env` na raiz do projeto:
```env
DATABASE_URL="postgresql://nest_rs:nest_rs_password@localhost:5432/nest_rs_db?schema=public"
```

4. Inicie o banco de dados PostgreSQL com Docker:
```bash
docker-compose up -d
```

5. Execute as migrations do Prisma:
```bash
npx prisma migrate dev
```

## ğŸ—„ï¸ Estrutura do Banco de Dados

O projeto possui os seguintes modelos:

### User (UsuÃ¡rio)
- `id` - UUID Ãºnico
- `name` - Nome do usuÃ¡rio
- `email` - Email Ãºnico
- `password` - Senha
- `createdAt` - Data de criaÃ§Ã£o
- `updatedAt` - Data de atualizaÃ§Ã£o

### Question (Pergunta)
- `id` - UUID Ãºnico
- `title` - TÃ­tulo da pergunta
- `slug` - Slug Ãºnico para URL
- `content` - ConteÃºdo da pergunta
- `authorId` - ID do autor (relacionamento com User)
- `createdAt` - Data de criaÃ§Ã£o
- `updatedAt` - Data de atualizaÃ§Ã£o

## ğŸƒ Executando o projeto

```bash
# Desenvolvimento
npm run start

# Modo watch (desenvolvimento)
npm run start:dev

# Modo debug
npm run start:debug

# ProduÃ§Ã£o
npm run start:prod
```

O servidor iniciarÃ¡ na porta `3333` por padrÃ£o.

## ğŸ“¡ API Endpoints

### POST /accounts
Cria uma nova conta de usuÃ¡rio.

**Request Body:**
```json
{
  "name": "John Doe",
  "email": "johndoe@email.com",
  "password": "123456"
}
```

**ValidaÃ§Ãµes:**
- `email` - Deve ser um email vÃ¡lido
- `password` - MÃ­nimo de 6 caracteres
- `name` - MÃ­nimo de 2 caracteres

**Responses:**
- `201` - Conta criada com sucesso
- `400` - Dados de validaÃ§Ã£o invÃ¡lidos
- `409` - UsuÃ¡rio jÃ¡ existe (email duplicado)

**Exemplo de erro de validaÃ§Ã£o:**
```json
{
  "message": "Validation failed",
  "errors": {
    "email": ["Invalid email"],
    "password": ["String must contain at least 6 character(s)"],
    "name": ["String must contain at least 2 character(s)"]
  },
  "error": "Bad Request",
  "statusCode": 400
}
```

**Exemplo de teste:**
Utilize o arquivo `http/create-account.http` com a extensÃ£o REST Client do VS Code.

## ğŸ”¨ Scripts disponÃ­veis

```bash
# Build do projeto
npm run build

# Formatar cÃ³digo
npm run format

# Gerar Prisma Client
npx prisma generate

# Criar nova migration
npx prisma migrate dev --name nome_da_migration

# Abrir Prisma Studio (GUI do banco)
npx prisma studio
```

## ğŸ³ Docker

O projeto utiliza Docker Compose para o PostgreSQL:

```yaml
services:
  postgres:
    container_name: nest-rs-postgres
    image: postgres
    ports:
      - '5432:5432'
    environment:
      POSTGRES_USER: nest_rs
      POSTGRES_PASSWORD: nest_rs_password
      POSTGRES_DB: nest_rs_db
```

Para gerenciar o container:
```bash
# Iniciar
docker-compose up -d

# Parar
docker-compose down

# Ver logs
docker-compose logs -f
```

## ğŸ“ Estrutura de pastas

```
nest-rs/
â”œâ”€â”€ http/                      # Arquivos HTTP para testes
â”‚   â””â”€â”€ create-account.http    # Teste do endpoint de criaÃ§Ã£o de conta
â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ schema.prisma          # Schema do Prisma
â”‚   â””â”€â”€ migrations/            # Migrations do banco
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â””â”€â”€ create-account.controller.ts  # Controller de criaÃ§Ã£o de conta
â”‚   â”œâ”€â”€ pipes/
â”‚   â”‚   â””â”€â”€ zod-validation-pipes.ts        # Pipe de validaÃ§Ã£o com Zod
â”‚   â”œâ”€â”€ prisma/
â”‚   â”‚   â””â”€â”€ prisma.service.ts  # ServiÃ§o do Prisma com lifecycle hooks
â”‚   â”œâ”€â”€ generated/
â”‚   â”‚   â””â”€â”€ prisma/            # Cliente Prisma gerado
â”‚   â”œâ”€â”€ app.module.ts          # MÃ³dulo principal
â”‚   â””â”€â”€ main.ts                # Entry point
â”œâ”€â”€ data/
â”‚   â””â”€â”€ pg/                    # Dados do PostgreSQL (gitignored)
â”œâ”€â”€ docker-compose.yml         # ConfiguraÃ§Ã£o Docker
â””â”€â”€ package.json
```

## ğŸ”‘ ConfiguraÃ§Ã£o do Prisma

O Prisma estÃ¡ configurado para:
- Gerar o cliente na pasta `src/generated/prisma` com formato CommonJS
- Usar o adaptador PostgreSQL (`@prisma/adapter-pg`) com Pool do `pg`
- Conectar via variÃ¡vel de ambiente `DATABASE_URL`
- Lifecycle hooks do NestJS (`OnModuleInit` e `OnModuleDestroy`) para gerenciar conexÃµes

## ğŸ›¡ï¸ ValidaÃ§Ã£o e SeguranÃ§a

O projeto implementa:
- **ValidaÃ§Ã£o de dados** com Zod atravÃ©s de custom pipe (`ZodValidationPipe`)
- **Hash de senhas** usando bcryptjs (salt rounds: 10)
- **ValidaÃ§Ã£o de email** para garantir formato correto
- **Mensagens de erro estruturadas** com detalhes dos campos invÃ¡lidos

## ğŸ§ª Testando a API

VocÃª pode testar os endpoints usando:

1. **REST Client (VS Code Extension)**: Utilize os arquivos `.http` na pasta `http/`
2. **Insomnia/Postman**: Importe as requisiÃ§Ãµes ou crie manualmente
3. **cURL**: 
```bash
curl -X POST http://localhost:3333/accounts \
  -H "Content-Type: application/json" \
  -d '{"name":"John Doe","email":"johndoe@email.com","password":"123456"}'
```

## ğŸ“ LicenÃ§a

Este projeto estÃ¡ sob a licenÃ§a UNLICENSED.

## ğŸ‘¨â€ğŸ’» Autor

Desenvolvido durante o curso da Rocketseat.

---

âŒ¨ï¸ com â¤ï¸ por [Rocketseat](https://rocketseat.com.br)
